name: Generar clave diaria

# Se ejecuta todos los días a las 00:00 UTC
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch: # Permite ejecutar manualmente si quieres

jobs:
  update-key:
    runs-on: ubuntu-latest
    steps:
      - name: Clonar repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_TOKEN }}

      - name: Generar clave diaria aleatoria
        id: generate
        run: |
          # Crear una clave tipo KEY- + timestamp + número aleatorio
          KEY="KEY-$(date +%s)-$((RANDOM % 10000))"
          echo "Clave generada: $KEY"
          # Guardar en el archivo key.txt
          echo $KEY > key.txt
          # Guardar para usar en el siguiente paso
          echo "DAILY_KEY=$KEY" >> $GITHUB_ENV

      - name: Configurar Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Hacer commit de key.txt
        run: |
          git add key.txt
          git commit -m "Actualizar clave diaria $(date +'%Y-%m-%d')" || echo "Sin cambios para commit"

      - name: Push de cambios
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git main
